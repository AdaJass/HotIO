
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>HotGraph</title>

  <script type="text/javascript">
  var userprefs = {
      goal: 'all',
      metric1: 'people',
      metric2: 'conversions',
      units: 'days',
      start: '2012-04-26',
      end: '2016-05-25',
      timezone: 'China/BeiJing',
      plan_id: 3
    };

</script>

  <link rel="stylesheet" href="/css/global.css">
  <link href="/css/graph.css" rel="stylesheet" />
  <script src="/js/graph.js"></script>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"===c.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.1.min.js';d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;"undefined"!==typeof f?
g=a[f]=[]:f="mixpanel";g.people=g.people||[];h="disable track track_pageview track_links track_forms register register_once unregister identify name_tag set_config people.identify people.set people.increment".split(" ");for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])};a.__SV=1.1})(document,window.mixpanel||[]);
mixpanel.init("eefb86c233fd45d58ffbbb6437a1cd96");</script>
  <!-- end Mixpanel -->

</head>
<body>

  <div class="container">
    <script type="text/javascript">currency_symbol = '$';</script>

    <div class="row">

      <div class="col-md-12">

        <div id="daterange" class="selectbox pull-right"> <i class="fa fa-calendar"></i>
          <span>最近3个月</span> <b class="caret"></b>
        </div>

        <!-- <div class="pull-right" style="margin-right: 10px">
          <select name="goal" id="goalfilter" style="width: 150px" multiple="multiple">
            <option value="signup">Signup</option>
          </select>
        </div> -->

        <div class="transparent-header">          
          <h1>星瀚火函数</h1>
        </div>

      </div>

    </div>

    <div class="row" style="margin-bottom: 20px">
      <div class="col-md-12">

        <div class="breadcrumbs">
          <ul class="breadcrumb-alt">
            <li>
              <a href="/private/main.html">转到孙悟空</a>
            </li>

            <li>
              <a href="/private/search">继续查</a>
            </li>
          </ul>
        </div>

      </div>
    </div>

    <div class="row" style="margin-bottom: 20px">
      <div class="col-md-12">
        <div class="page page-white">
          <div id="graph" class="graph">

            <div class="pull-right">

              <select name="graph_metric1" style="width: 140px">
                <option value="people">百度</option>
                <option value="clicks">知乎</option>
                <option value="conversions">贴吧</option>
                <!-- <option value="convrate">Conversion Rate</option>
                <option value="cost">Cost</option>
                <option value="cpa">CPA</option>
                <option value="cpc">CPC</option>
                <option value="revenue">Revenue</option>
                <option value="rpp">RPP</option>
                <option value="profit">Profit</option> -->
              </select>

              <select name="graph_metric2" style="width: 140px">
                <option value="people">百度</option>
                <option value="clicks">知乎</option>
                <option value="conversions">贴吧</option>
                <!-- <option value="convrate">Conversion Rate</option>
                <option value="cost">Cost</option>
                <option value="cpa">CPA</option>
                <option value="cpc">CPC</option>
                <option value="revenue">Revenue</option>
                <option value="rpp">RPP</option>
                <option value="profit">Profit</option> -->
              </select>

              <!--
        <select name="graph_units" style="width: 100px; display: none">
              <option value="days">Days</option>
              <option value="weeks">Weeks</option>
              <option value="months">Months</option>
            </select>
            -->
            <!-- <btn class="btn btn-default btn-sm graph_download" rel="tooltip" title="Download Excel CSV" style="margin-left: 7px; background: #fff; border-width: 1px"> <i class="fa fa-download"></i>
            </btn> -->

          </div>

          <div class="pull-left metric1">
            <h1 style="font-weight: normal; color: #08c; margin: 0; font-size: 30px; line-height: 1.1em"></h1>
            <h2 style="font-weight: normal; color: #ababab; margin: 0; letter-spacing: .15em; text-transform: uppercase; line-height: 1.5em; font-size: 12px">People</h2>
          </div>

          <div class="pull-left metric2" style="margin-left: 30px">
            <h1 style="font-weight: normal; color: #390; margin: 0; font-size: 30px; line-height: 1.1em"></h1>
            <h2 style="font-weight: normal; color: #ababab; margin: 0; letter-spacing: .15em; text-transform: uppercase; line-height: 1.5em; font-size: 12px">Conversions</h2>
          </div>

          <div class="placeholder" style="clear: both; margin: 0 -10px -10px -10px"></div>

        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript">

  var updates = 0;
  /*var loading = $('#report tbody .loading').hide().clone();
  var nodata = $('#report tbody .nodata').hide().clone();*/

  $(document).ready(function() {
      getGraph(); 
      inter++;     
      timer=setInterval(getGraph,5000);
      setTimeout(failSomeWhere, 50000);
      //drawGraph();
  });

  var jsondata=[
    {    
        "date": "2016-04-26",
        "people": "30",
        "clicks": "37",
        "conversions": "5"    
    }, {
        "date": "2016-04-27",
        "people": "41",
        "clicks": "42",
        "conversions": "2"    
    }, {
        "date": "2016-04-28",
        "people": "28",
        "clicks": "58",
        "conversions": "12"    
    }, {
        "date": "2016-04-29",
        "people": "19",
        "clicks": "23",
        "conversions": "5"    
    }, {
        "date": "2016-04-30",
        "people": "17",
        "clicks": "18",
        "conversions": "0"    
    }, {
        "date": "2016-05-01",
        "people": "25",
        "clicks": "27",
        "conversions": "0"    
    }, {
        "date": "2016-05-02",
        "people": "34",
        "clicks": "39",
        "conversions": "3"    
    }, {
        "date": "2016-05-03",
        "people": "13",
        "clicks": "16",
        "conversions": "5"    
    }, {
        "date": "2016-05-04",
        "people": "21",
        "clicks": "23",
        "conversions": "0"    
    }, {
        "date": "2016-05-05",
        "people": "27",
        "clicks": "31",
        "conversions": "0"    
    }, {
        "date": "2016-05-06",
        "people": "50",
        "clicks": "35",
        "conversions": "0"    
    }, {
        "date": "2016-05-07",
        "people": "11",
        "clicks": "19",
        "conversions": "0"    
    }, {
        "date": "2016-05-08",
        "people": "20",
        "clicks": "21",
        "conversions": "1"    
    }, {
        "date": "2016-05-09",
        "people": "14",
        "clicks": "15",
        "conversions": "2"    
    }, {
        "date": "2016-05-10",
        "people": "21",
        "clicks": "27",
        "conversions": "0"    
    }, {
        "date": "2016-05-11",
        "people": "23",
        "clicks": "24",
        "conversions": "5"    
    }, {
        "date": "2016-05-12",
        "people": "33",
        "clicks": "33",
        "conversions": "2"    
    }, {
        "date": "2016-05-13",
        "people": "29",
        "clicks": "22",
        "conversions": "1"    
    }, {
        "date": "2016-05-14",
        "people": "19",
        "clicks": "19",
        "conversions": "0"    
    }, {
        "date": "2016-05-15",
        "people": "11",
        "clicks": "18",
        "conversions": "1"    
    }, {
        "date": "2016-05-16",
        "people": "36",
        "clicks": "34",
        "conversions": "0"    
    }, {
        "date": "2016-05-17",
        "people": "25",
        "clicks": "27",
        "conversions": "1"    
    }, {
        "date": "2016-05-18",
        "people": "20",
        "clicks": "30",
        "conversions": "1"    
    }, {
        "date": "2016-05-19",
        "people": "24",
        "clicks": "24",
        "conversions": "3"    
    }, {
        "date": "2016-05-20",
        "people": "28",
        "clicks": "30",
        "conversions": "0"    
    }, {
        "date": "2016-05-21",
        "people": "17",
        "clicks": "12",
        "conversions": "0"    
    }, {
        "date": "2016-05-22",
        "people": "23",
        "clicks": "25",
        "conversions": "2"    
    }, {
        "date": "2016-05-23",
        "people": "14",
        "clicks": "14",
        "conversions": "1"    
    }, {
        "date": "2016-05-24",
        "people": "15",
        "clicks": "14",
        "conversions": "0"    
    }, {
        "date": "2016-05-25",
        "people": "18",
        "clicks": "13",
        "conversions": "0"    
    }/*, {
        "date": null,
        "people": "688",
        "clicks": "719",
        "conversions": "11"    
    }*/
  ];

  var inter=0; 

  /*function wrapper(){    
    getGraph();        
  }*/
 
  function getGraph(start, end) {
      if(inter==0) {   
        $('#graph .placeholder').html('<div style="padding: 40px 0 0 0; text-align: center; font-size: 18px">Loading...</div>');
        $('#graph h1, #graph h2').html('&nbsp;');
        $('#graph .metric1 h1').html('<i class="fa fa-spinner fa-spin"></i>'); 
      }    
      jsonurl = '/private/respond_data?page=json&type=graph';      
      /*jsonurl += '&web1=' + userprefs.metric1 + '&web2=' + userprefs.metric2;*/      
      if (typeof start != 'undefined' && typeof end != 'undefined' && start != null & end != null)
        jsonurl += '&start=' + encodeURIComponent(start) + '&end=' + encodeURIComponent(end);
      if(inter==0){
        imGraph('graph',jsondata);
      }

      $.getJSON(jsonurl, function(data) {
          
          if (data.length != 0){
            //jsonData=JSON.parse(data);
            //alert(data[0]);

            if(data[0]['clicks']!=undefined&&data[0]['people']!=undefined&&data[0]['conversions']!=undefined)
            {                  
              //alert("i have been here!!");
              if(timer)
                clearInterval(timer);
              imGraph('graph', data);
            }  
                   
          }          
      });

  } 

  function failSomeWhere()
  {    
    $.getJSON(jsonurl, function(data) {imGraph('graph',data); });
    if(timer)
      clearInterval(timer);
    setTimeout(getGraph,20000);
    alert('服务器网速有问题，抓取数据可能未完整。');
  }
</script>

</div>
</body>
</html>